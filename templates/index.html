<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asistente Inteligente de P√≥ker</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2e7d32;
            --primary-light: #60ad5e;
            --primary-dark: #005005;
            --secondary: #ffc107;
            --secondary-light: #fff350;
            --secondary-dark: #c79100;
            --background: #0a3d2f;
            --background-light: #1a5d4a;
            --background-dark: #042a20;
            --text: #ffffff;
            --text-secondary: #e0e0e0;
            --card-bg: #ffffff;
            --card-text: #333333;
        }

        .dark-mode {
            --primary: #4caf50;
            --primary-light: #80e27e;
            --primary-dark: #087f23;
            --secondary: #ffc107;
            --secondary-light: #fff350;
            --secondary-dark: #c79100;
            --background: #121212;
            --background-light: #1e1e1e;
            --background-dark: #000000;
            --text: #ffffff;
            --text-secondary: #b0b0b0;
            --card-bg: #1e1e1e;
            --card-text: #ffffff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.5s ease, color 0.3s ease;
        }

        body {
            font-family: 'Open Sans', sans-serif;
            background: linear-gradient(135deg, var(--background-dark), var(--background-light), var(--background-dark));
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
            animation: gradientShift 15s ease infinite;
            background-size: 300% 300%;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 2fr 1fr; /* Cambiado a 2:1 */
            gap: 25px;
            min-height: calc(100vh - 40px);
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .game-section {
            display: flex;
            flex-direction: column;
        }

        .analysis-section {
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            max-height: calc(100vh - 80px);
        }

        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            grid-column: 1 / -1;
        }

        h1 {
            text-align: center;
            color: var(--primary-light);
            text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.5);
            font-family: 'Montserrat', sans-serif;
            font-size: 2.8rem;
            font-weight: 700;
            letter-spacing: 1px;
            position: relative;
            animation: titleGlow 3s ease-in-out infinite alternate;
        }

        @keyframes titleGlow {
            from { text-shadow: 0 0 5px var(--primary-light); }
            to { text-shadow: 0 0 20px var(--primary-light); }
        }

        .title-cards {
            display: flex;
            gap: 10px;
        }

        .title-card {
            width: 40px;
            height: 60px;
            background: var(--card-bg);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--card-text);
            border: 2px solid var(--primary);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: rotate(10deg);
            animation: cardFloat 4s ease-in-out infinite;
        }

        .title-card:nth-child(2) {
            transform: rotate(-5deg);
            animation-delay: 0.5s;
        }

        .title-card:nth-child(3) {
            transform: rotate(5deg);
            animation-delay: 1s;
        }

        @keyframes cardFloat {
            0%, 100% { transform: translateY(0) rotate(10deg); }
            50% { transform: translateY(-15px) rotate(10deg); }
        }

        h2 {
            color: var(--primary-light);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 8px;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.8rem;
            font-weight: 600;
        }

        h3 {
            color: var(--secondary);
            margin: 20px 0 15px 0;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.4rem;
            font-weight: 600;
        }

        .game-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        button {
            background: linear-gradient(45deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            padding: 14px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            font-size: 1rem;
            font-family: 'Montserrat', sans-serif;
            position: relative;
            overflow: hidden;
        }

        button::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.4);
        }

        button:hover::after {
            left: 100%;
        }

        button:active {
            transform: translateY(1px);
        }

        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.7;
        }

        .danger-btn {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            box-shadow: 0 4px 15px rgba(244, 67, 54, 0.3);
        }

        .warning-btn {
            background: linear-gradient(45deg, var(--secondary), var(--secondary-dark));
            box-shadow: 0 4px 15px rgba(255, 152, 0, 0.3);
        }

        .poker-table {
            background: radial-gradient(ellipse, var(--background-dark), var(--background));
            border: 3px solid var(--primary);
            border-radius: 20px;
            padding: 25px;
            margin: 25px 0;
            position: relative;
            min-height: 250px;
            animation: tableGlow 3s ease-in-out infinite alternate;
        }

        @keyframes tableGlow {
            from { box-shadow: 0 0 10px rgba(46, 125, 50, 0.5); }
            to { box-shadow: 0 0 20px rgba(46, 125, 50, 0.8); }
        }

        .community-cards, .player-cards {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .card-display {
            width: 80px;
            height: 115px;
            background: var(--card-bg);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.8rem;
            color: var(--card-text);
            border: 2px solid var(--primary);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card-display::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(
                to bottom right,
                rgba(255, 255, 255, 0.3),
                rgba(255, 255, 255, 0)
            );
            transform: rotate(30deg);
            transition: all 0.5s ease;
        }

        .card-display:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
        }

        .card-display:hover::before {
            left: 100%;
            top: 100%;
        }

        .red {
            color: #d32f2f;
        }

        .black {
            color: #333;
        }

        .out-card {
            width: 45px;
            height: 65px;
            background: var(--card-bg);
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1rem;
            border: 1px solid var(--primary);
            margin: 5px;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.2);
            transition: all 0.2s ease;
        }

        .out-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 12px rgba(0, 0, 0, 0.3);
        }

        .out-card.red {
            color: #d32f2f;
        }

        .out-card.black {
            color: #333;
        }

        .game-stage {
            text-align: center;
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--secondary);
            margin: 15px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-shadow: 0 0 8px rgba(255, 193, 7, 0.5);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        .analysis-panel {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }

        .analysis-panel.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid var(--primary);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(76, 175, 80, 0.2);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-light);
            display: block;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        .suggestion-box {
            background: linear-gradient(45deg, rgba(76, 175, 80, 0.2), rgba(56, 142, 60, 0.2));
            border: 2px solid var(--primary);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .suggestion-box::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .confidence-bar {
            width: 100%;
            height: 10px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 5px;
            overflow: hidden;
            margin: 15px 0;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #f44336, #ff9800, #4CAF50);
            border-radius: 5px;
            transition: width 0.8s ease;
        }

        .outs-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }

        .custom-hand-section {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid var(--secondary);
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .custom-hand-inputs {
            display: flex;
            gap: 15px;
            margin: 15px 0;
            flex-wrap: wrap;
            align-items: center;
        }

        select, input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            padding: 10px 15px;
            color: var(--text);
            font-size: 1rem;
            font-family: 'Open Sans', sans-serif;
            min-width: 160px;
            transition: all 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.3);
        }

        select option {
            background: var(--background-dark);
            color: var(--text);
        }

        .loading {
            display: none;
            text-align: center;
            color: var(--primary-light);
            font-style: italic;
            font-size: 1.2rem;
            margin: 20px 0;
        }

        .error {
            background: rgba(244, 67, 54, 0.2);
            border: 1px solid #f44336;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #ffcdd2;
            font-size: 1rem;
        }

        .success {
            background: rgba(76, 175, 80, 0.2);
            border: 1px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
            color: #c8e6c9;
            font-size: 1rem;
        }

        .board-texture {
            display: inline-block;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
            margin: 5px;
        }

        .texture-wet { background: #2196F3; }
        .texture-dry { background: #FF9800; }
        .texture-dangerous { background: #f44336; }
        .texture-paired { background: #9C27B0; }

        .probability-meter {
            width: 100%;
            height: 25px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .probability-fill {
            height: 100%;
            background: linear-gradient(90deg, #f44336 0%, #ff9800 25%, #FFC107 50%, #8BC34A 75%, #4CAF50 100%);
            border-radius: 12px;
            transition: width 1s ease;
        }

        .probability-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1rem;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);
        }

        label {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-right: 10px;
        }

        .theme-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(30deg);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        .theme-toggle:active {
            transform: scale(0.95);
        }

        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .title-cards {
                display: none;
            }
            
            h2 {
                font-size: 1.5rem;
            }
            
            h3 {
                font-size: 1.2rem;
            }
            
            .game-controls {
                justify-content: center;
            }
            
            button {
                padding: 12px 18px;
                font-size: 0.9rem;
            }
            
            .card-display {
                width: 65px;
                height: 95px;
                font-size: 1.4rem;
            }
            
            .out-card {
                width: 40px;
                height: 55px;
                font-size: 0.9rem;
            }

            .theme-toggle {
                width: 40px;
                height: 40px;
                font-size: 1.2rem;
                top: 15px;
                right: 15px;
            }
        }
    </style>
</head>
<body>
    <button class="theme-toggle" id="themeToggle">üåì</button>

    <div class="container">
        <div class="title-container">
            <div class="title-cards">
                <div class="title-card red">A‚ô•</div>
                <div class="title-card black">K‚ô†</div>
                <div class="title-card red">Q‚ô¶</div>
            </div>
            <h1>Asistente Inteligente de P√≥ker</h1>
            <div class="title-cards">
                <div class="title-card black">J‚ô£</div>
                <div class="title-card red">10‚ô•</div>
                <div class="title-card black">9‚ô†</div>
            </div>
        </div>

        <!-- Secci√≥n del Juego -->
        <div class="card game-section">
            <h2>üéÆ Mesa de P√≥ker</h2>
            
            <div class="game-controls">
                <button onclick="newGame()">Nuevo Juego</button>
                <button id="dealBtn" onclick="dealCards()" disabled>Repartir Cartas</button>
                <button onclick="analyzeHand()" id="analyzeBtn" disabled>Analizar Mano</button>
                <button onclick="resetGame()" class="warning-btn">Reiniciar</button>
            </div>

            <!-- Configuraci√≥n inicial -->
            <div id="gameSetup" class="custom-hand-section">
                <h3>Configuraci√≥n del Juego</h3>
                <div class="custom-hand-inputs">
                    <label>Jugadores:</label>
                    <select id="numPlayers">
                        <option value="2">2 Jugadores</option>
                        <option value="3">3 Jugadores</option>
                        <option value="4">4 Jugadores</option>
                        <option value="5">5 Jugadores</option>
                        <option value="6">6 Jugadores</option>
                    </select>
                </div>
            </div>

            <!-- Mesa de p√≥ker -->
            <div class="poker-table">
                <div class="game-stage">
                    <span id="gameStage">Etapa del Juego</span>
                </div>
                <div id="communityCards" class="community-cards">
                    <div style="text-align: center; width: 100%; color: var(--text-secondary); font-size: 1.1rem;">Cartas Comunitarias</div>
                </div>
                <div id="playerCards" class="player-cards">
                    <div style="text-align: center; width: 100%; color: var(--text-secondary); font-size: 1.1rem;">Tus Cartas</div>
                </div>
            </div>

            <!-- Mano personalizada -->
            <div class="custom-hand-section">
                <h3>üéØ Establecer Mano Personalizada (Opcional)</h3>
                <div class="custom-hand-inputs">
                    <select id="card1Rank">
                        <option value="">Carta 1 - Valor</option>
                        <option value="ACE">As</option>
                        <option value="KING">Rey</option>
                        <option value="QUEEN">Reina</option>
                        <option value="JACK">Jota</option>
                        <option value="TEN">10</option>
                        <option value="NINE">9</option>
                        <option value="EIGHT">8</option>
                        <option value="SEVEN">7</option>
                        <option value="SIX">6</option>
                        <option value="FIVE">5</option>
                        <option value="FOUR">4</option>
                        <option value="THREE">3</option>
                        <option value="TWO">2</option>
                    </select>
                    <select id="card1Suit">
                        <option value="">Palo</option>
                        <option value="HEARTS">‚ô• Corazones</option>
                        <option value="DIAMONDS">‚ô¶ Diamantes</option>
                        <option value="CLUBS">‚ô£ Tr√©boles</option>
                        <option value="SPADES">‚ô† Picas</option>
                    </select>
                    <select id="card2Rank">
                        <option value="">Carta 2 - Valor</option>
                        <option value="ACE">As</option>
                        <option value="KING">Rey</option>
                        <option value="QUEEN">Reina</option>
                        <option value="JACK">Jota</option>
                        <option value="TEN">10</option>
                        <option value="NINE">9</option>
                        <option value="EIGHT">8</option>
                        <option value="SEVEN">7</option>
                        <option value="SIX">6</option>
                        <option value="FIVE">5</option>
                        <option value="FOUR">4</option>
                        <option value="THREE">3</option>
                        <option value="TWO">2</option>
                    </select>
                    <select id="card2Suit">
                        <option value="">Palo</option>
                        <option value="HEARTS">‚ô• Corazones</option>
                        <option value="DIAMONDS">‚ô¶ Diamantes</option>
                        <option value="CLUBS">‚ô£ Tr√©boles</option>
                        <option value="SPADES">‚ô† Picas</option>
                    </select>
                    <button onclick="setCustomHand()">Establecer Mano</button>
                </div>
            </div>

            <div class="loading" id="loading">üé≤ Procesando...</div>
            <div id="messages"></div>
        </div>

        <!-- Secci√≥n de An√°lisis -->
        <div class="card analysis-section">
            <h2>üìä An√°lisis Inteligente</h2>

            <!-- Panel de an√°lisis b√°sico -->
            <div id="basicAnalysis" class="analysis-panel">
                <h3>üí™ Fuerza de tu Mano</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-value" id="currentHand">-</span>
                        <div class="stat-label">Mano Actual</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="handStrength">-</span>
                        <div class="stat-label">Percentil</div>
                    </div>
                </div>

                <h3>üéØ Probabilidad de Victoria</h3>
                <div class="probability-meter">
                    <div class="probability-fill" id="winProbabilityBar" style="width: 0%"></div>
                    <div class="probability-text" id="winProbabilityText">0%</div>
                </div>

                <h3>üÉè Outs (Cartas que te ayudan)</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <span class="stat-value" id="totalOuts">0</span>
                        <div class="stat-label">Total de Outs</div>
                    </div>
                    <div class="stat-card">
                        <span class="stat-value" id="improveProbability">0%</span>
                        <div class="stat-label">Prob. Mejorar</div>
                    </div>
                </div>
                <div class="outs-list" id="outsList"></div>

                <h3>üé™ Recomendaci√≥n de Acci√≥n</h3>
                <div class="suggestion-box">
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 15px;" id="suggestedAction">-</div>
                    <div id="actionReason" style="color: var(--text-secondary); font-size: 1.1rem;">-</div>
                    <div class="confidence-bar">
                        <div class="confidence-fill" id="confidenceBar" style="width: 0%"></div>
                    </div>
                    <div style="font-size: 1rem; text-align: center; margin-top: 10px;">
                        Confianza: <span id="confidenceText">0</span>/10
                    </div>
                </div>
            </div>

            <!-- Panel de an√°lisis avanzado -->
            <div id="advancedAnalysis" class="analysis-panel">
                <h3>üïµ An√°lisis de Oponentes</h3>
                <div id="opponentAnalysis">
                    <div class="stat-card">
                        <span class="stat-value" id="boardTexture">-</span>
                        <div class="stat-label">Textura del Board</div>
                    </div>
                    <div id="opponentHands" style="margin: 15px 0; font-size: 1.1rem;"></div>
                </div>

                <h3>üé≠ An√°lisis de Bluff</h3>
                <div id="bluffAnalysis" class="suggestion-box">
                    <div id="bluffRecommendation" style="font-weight: bold; font-size: 1.3rem;">-</div>
                    <div id="bluffReasoning" style="color: var(--text-secondary); margin-top: 15px; font-size: 1.1rem;">-</div>
                </div>

                <h3>üé® An√°lisis de Draws</h3>
                <div id="drawAnalysis">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <span class="stat-value" id="drawStrength">-</span>
                            <div class="stat-label">Fuerza del Draw</div>
                        </div>
                        <div class="stat-card">
                            <span class="stat-value" id="semiBluffPotential">-</span>
                            <div class="stat-label">Semi-Bluff</div>
                        </div>
                    </div>
                    <div id="drawTypes" style="margin: 15px 0; font-size: 1.1rem;"></div>
                </div>
            </div>

            <div class="game-controls" style="margin-top: 25px;">
                <button onclick="showAdvancedAnalysis()" id="advancedBtn" disabled>An√°lisis Avanzado</button>
                <button onclick="simulateCards()" id="simulateBtn" disabled>Simular Cartas</button>
            </div>
        </div>
    </div>

    <script>
    let currentGameId = null;
    let gameState = null;
    let darkMode = false;

    // Toggle de tema oscuro
    document.getElementById('themeToggle').addEventListener('click', function() {
        darkMode = !darkMode;
        if (darkMode) {
            document.body.classList.add('dark-mode');
            this.textContent = 'üåû';
        } else {
            document.body.classList.remove('dark-mode');
            this.textContent = 'üåì';
        }
    });

    // Utilidades
    function showMessage(message, type = 'success') {
        const messagesDiv = document.getElementById('messages');
        const messageElement = document.createElement('div');
        messageElement.className = type;
        messageElement.textContent = message;
        messagesDiv.appendChild(messageElement);
        
        setTimeout(() => {
            messagesDiv.removeChild(messageElement);
        }, 5000);
    }

    function showLoading(show = true) {
        document.getElementById('loading').style.display = show ? 'block' : 'none';
    }

    function getCardColor(suit) {
        return (suit === 'HEARTS' || suit === 'DIAMONDS') ? 'red' : 'black';
    }

    function getSuitSymbol(suit) {
        const symbols = {
            'HEARTS': '‚ô•',
            'DIAMONDS': '‚ô¶',
            'CLUBS': '‚ô£',
            'SPADES': '‚ô†'
        };
        return symbols[suit] || suit;
    }

    function getRankSymbol(rank) {
        const symbols = {
            'ACE': 'A',
            'KING': 'K',
            'QUEEN': 'Q',
            'JACK': 'J',
            'TEN': '10',
            'NINE': '9',
            'EIGHT': '8',
            'SEVEN': '7',
            'SIX': '6',
            'FIVE': '5',
            'FOUR': '4',
            'THREE': '3',
            'TWO': '2'
        };
        return symbols[rank] || rank;
    }

    function createCardElement(cardData, small = false) {
        if (!cardData) return null;
        
        const cardDiv = document.createElement('div');
        cardDiv.className = small ? 'out-card' : 'card-display';
        cardDiv.classList.add(getCardColor(cardData.suit));
        cardDiv.textContent = getRankSymbol(cardData.rank) + getSuitSymbol(cardData.suit);
        return cardDiv;
    }

    function updateGameDisplay() {
        if (!gameState || !gameState.players || !Array.isArray(gameState.players) || !gameState.players[0] || !Array.isArray(gameState.players[0].hand) || !gameState.community_cards) {
            console.error('Estado del juego inv√°lido:', gameState);
            return;
        }

        // Actualizar etapa del juego
        document.getElementById('gameStage').textContent = gameState.stage || 'Etapa desconocida';

        // Limpiar cartas existentes
        const communityCardsDiv = document.getElementById('communityCards');
        const playerCardsDiv = document.getElementById('playerCards');
        communityCardsDiv.innerHTML = '<div style="text-align: center; width: 100%; color: var(--text-secondary); font-size: 1.1rem;">Cartas Comunitarias</div>';
        playerCardsDiv.innerHTML = '<div style="text-align: center; width: 100%; color: var(--text-secondary); font-size: 1.1rem;">Tus Cartas</div>';

        // Mostrar cartas comunitarias
        if (Array.isArray(gameState.community_cards)) {
            gameState.community_cards.forEach(card => {
                if (card && typeof card === 'object') {
                    communityCardsDiv.appendChild(createCardElement(card));
                }
            });
        }

        // Mostrar cartas del jugador
        if (Array.isArray(gameState.players) && gameState.players.length > 0 && Array.isArray(gameState.players[0].hand)) {
            gameState.players[0].hand.forEach(card => {
                if (card && typeof card === 'object') {
                    playerCardsDiv.appendChild(createCardElement(card));
                }
            });
        }

        // Actualizar botones
        const dealBtn = document.getElementById('dealBtn');
        const analyzeBtn = document.getElementById('analyzeBtn');
        
        if (gameState.stage) {
            if (gameState.stage === 'pre-flop') {
                dealBtn.textContent = 'Repartir Cartas';
                dealBtn.disabled = false;
                analyzeBtn.disabled = false;
            } else if (['flop', 'turn', 'river'].includes(gameState.stage)) {
                dealBtn.textContent = 'Repartir Siguiente';
                dealBtn.disabled = false;
                analyzeBtn.disabled = false;
            } else {
                dealBtn.disabled = true;
                analyzeBtn.disabled = true;
            }
        } else {
            dealBtn.disabled = true;
            analyzeBtn.disabled = true;
        }
    }

    // Funciones principales del juego
    async function newGame() {
        showLoading(true);
        
        try {
            const numPlayers = document.getElementById('numPlayers').value;
            const response = await fetch('/new_game', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    num_players: parseInt(numPlayers)
                })
            });
            
            if (!response.ok) {
                const error = await response.json();
                showMessage(error.error || 'Error creando el juego', 'error');
                return;
            }
            
            const data = await response.json();
            
            if (data.error) {
                showMessage(data.error, 'error');
                return;
            }
            
            currentGameId = data.game_id;
            gameState = data.game_state;
            updateGameDisplay();
            
            document.getElementById('dealBtn').disabled = false;
            showMessage(data.message);
            
        } catch (error) {
            if (error instanceof TypeError) {
                showMessage('Error creando el juego: ' + error.message, 'error');
            } else {
                showMessage('Error creando el juego: ' + (error.message || error), 'error');
            }
        } finally {
            showLoading(false);
        }
    }

    async function dealCards() {
        if (!currentGameId) {
            showMessage('Primero crea un nuevo juego', 'error');
            return;
        }

        showLoading(true);

        try {
            const response = await fetch('/deal_cards', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    game_id: currentGameId
                })
            });

            if (!response.ok) {
                const error = await response.json();
                showMessage(error.error || 'Error repartiendo cartas', 'error');
                return;
            }

            const data = await response.json();
            
            if (data.error) {
                showMessage(data.error, 'error');
                return;
            }

            gameState = data.game_state;
            updateGameDisplay();
            showMessage(data.message);
            
            // Habilitar an√°lisis si tenemos cartas suficientes
            if (gameState.community_cards.length >= 3) {
                document.getElementById('analyzeBtn').disabled = false;
            }
            
        } catch (error) {
            showMessage('Error repartiendo cartas: ' + (error.message || error), 'error');
        } finally {
            showLoading(false);
        }
    }

    async function analyzeHand() {
        if (!currentGameId) {
            showMessage('Primero crea un nuevo juego', 'error');
            return;
        }

        showLoading(true);

        try {
            const response = await fetch('/analyze_hand', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    game_id: currentGameId,
                    player_idx: 0
                })
            });

            if (!response.ok) {
                const error = await response.json();
                showMessage(error.error || 'Error en el an√°lisis', 'error');
                return;
            }

            const data = await response.json();
            
            if (data.error) {
                showMessage(data.error, 'error');
                return;
            }

            updateAnalysisDisplay(data.analysis);
            document.getElementById('basicAnalysis').classList.add('active');
            document.getElementById('advancedBtn').disabled = false;
            document.getElementById('simulateBtn').disabled = false;
            showMessage('An√°lisis completado');
            
        } catch (error) {
            showMessage('Error en el an√°lisis: ' + (error.message || error), 'error');
        } finally {
            showLoading(false);
        }
    }

    async function showAdvancedAnalysis() {
        if (!currentGameId) {
            showMessage('Primero analiza la mano b√°sica', 'error');
            return;
        }

        showLoading(true);

        try {
            const response = await fetch('/advanced_analysis', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    game_id: currentGameId,
                    player_idx: 0
                })
            });

            const data = await response.json();
            
            if (data.error) {
                showMessage(data.error, 'error');
                return;
            }

            updateAdvancedAnalysisDisplay(data);
            document.getElementById('advancedAnalysis').classList.add('active');
            showMessage('An√°lisis avanzado completado');
            
        } catch (error) {
            showMessage('Error en el an√°lisis avanzado: ' + error.message, 'error');
        } finally {
            showLoading(false);
        }
    }

    async function setCustomHand() {
        if (!currentGameId) {
            showMessage('Primero crea un nuevo juego', 'error');
            return;
        }

        const card1Rank = document.getElementById('card1Rank').value;
        const card1Suit = document.getElementById('card1Suit').value;
        const card2Rank = document.getElementById('card2Rank').value;
        const card2Suit = document.getElementById('card2Suit').value;

        if (!card1Rank || !card1Suit || !card2Rank || !card2Suit) {
            showMessage('Selecciona ambas cartas completamente', 'error');
            return;
        }

        if (card1Rank === card2Rank && card1Suit === card2Suit) {
            showMessage('No puedes tener la misma carta dos veces', 'error');
            return;
        }

        showLoading(true);

        try {
            const response = await fetch('/set_custom_hand', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    game_id: currentGameId,
                    player_idx: 0,
                    cards: [
                        { rank: card1Rank, suit: card1Suit },
                        { rank: card2Rank, suit: card2Suit }
                    ]
                })
            });

            const data = await response.json();
            
            if (data.error) {
                showMessage(data.error, 'error');
                return;
            }

            gameState = data.game_state;
            updateGameDisplay();
            showMessage(data.message);
            
        } catch (error) {
            showMessage('Error estableciendo mano personalizada: ' + error.message, 'error');
        } finally {
            showLoading(false);
        }
    }

    async function resetGame() {
        if (!currentGameId) {
            showMessage('No hay juego para reiniciar', 'error');
            return;
        }

        showLoading(true);

        try {
            const response = await fetch(`/reset_game/${currentGameId}`, {
                method: 'POST'
            });

            const data = await response.json();
            
            if (data.error) {
                showMessage(data.error, 'error');
                return;
            }

            gameState = data.game_state;
            updateGameDisplay();
            resetAnalysisDisplay();
        } catch (error) {
            showMessage('Error reiniciando el juego: ' + error.message, 'error');
        } finally {
            showLoading(false);
        }
    }

    // Funciones para actualizar la interfaz
    function updateGameDisplay() {
        // Actualiza la visualizaci√≥n de las cartas del jugador y las comunitarias
        const playerCardsDiv = document.getElementById('playerCards');
        const communityCardsDiv = document.getElementById('communityCards');
        
        playerCardsDiv.innerHTML = '';
        communityCardsDiv.innerHTML = '';

        gameState.players[0].hand.forEach(card => {
            playerCardsDiv.appendChild(createCardElement(card));
        });

        gameState.community_cards.forEach(card => {
            communityCardsDiv.appendChild(createCardElement(card));
        });

        document.getElementById('gameStage').textContent = `Etapa: ${gameState.stage}`;
    }

    function updateAnalysisDisplay(analysis) {
        // Actualiza la visualizaci√≥n del an√°lisis de la mano
        document.getElementById('currentHand').textContent = analysis.additional_info.current_hand;
        document.getElementById('handStrength').textContent = analysis.additional_info.strength_percentile.toFixed(1) + '%';
        document.getElementById('totalOuts').textContent = analysis.additional_info.total_outs;
        document.getElementById('improveProbability').textContent = analysis.additional_info.improvement_probability.toFixed(1) + '%';
        
        const outsList = document.getElementById('outsList');
        outsList.innerHTML = '';
        analysis.additional_info.out_cards.forEach(card => {
            outsList.appendChild(createCardElement(card, true));
        });

        document.getElementById('suggestedAction').textContent = analysis.action;
        document.getElementById('actionReason').textContent = analysis.reason;
        document.getElementById('confidenceBar').style.width = analysis.confidence * 10 + '%';
        document.getElementById('confidenceText').textContent = analysis.confidence;
        
        // Actualizar probabilidad de victoria
        const winProbability = analysis.additional_info.win_percentage;
        document.getElementById('winProbabilityBar').style.width = winProbability + '%';
        document.getElementById('winProbabilityText').textContent = winProbability.toFixed(1) + '%';
    }

    function resetAnalysisDisplay() {
        // Resetea la visualizaci√≥n del an√°lisis
        document.getElementById('currentHand').textContent = '-';
        document.getElementById('handStrength').textContent = '-';
        document.getElementById('totalOuts').textContent = '0';
        document.getElementById('improveProbability').textContent = '0%';
        document.getElementById('outsList').innerHTML = '';
        document.getElementById('suggestedAction').textContent = '-';
        document.getElementById('actionReason').textContent = '-';
        document.getElementById('confidenceBar').style.width = '0%';
        document.getElementById('confidenceText').textContent = '0';
        document.getElementById('winProbabilityBar').style.width = '0%';
        document.getElementById('winProbabilityText').textContent = '0%';
    }

    function updateAdvancedAnalysisDisplay(data) {
        console.log('Datos recibidos en updateAdvancedAnalysisDisplay:', JSON.stringify(data, null, 2));
        // Actualiza la visualizaci√≥n del an√°lisis avanzado
        document.getElementById('boardTexture').textContent = data.analysis.opponent_analysis.board_texture;
        const opponentHandsDiv = document.getElementById('opponentHands');
        opponentHandsDiv.innerHTML = '';

        for (const [hand, percentage] of Object.entries(data.analysis.opponent_analysis.percentages)) {
            const handDiv = document.createElement('div');
            handDiv.textContent = ` ${hand}: ${percentage.toFixed(1)}%`;
            opponentHandsDiv.appendChild(handDiv);
        }

        // An√°lisis de bluff
        const bluff = data.analysis.bluff_analysis;
        document.getElementById('bluffRecommendation').textContent = bluff.bluff_recommended ? 'S√ç' : 'NO';
        document.getElementById('bluffReasoning').textContent = bluff.reasoning;

        // An√°lisis de draws
        const draw = data.drawing_analysis;
        document.getElementById('drawStrength').textContent = draw.draw_strength;
        document.getElementById('semiBluffPotential').textContent = draw.semi_bluff_potential ? 'S√≠' : 'No';
        
        const drawTypesDiv = document.getElementById('drawTypes');
        drawTypesDiv.innerHTML = '';
        draw.draw_types.forEach(type => {
            const typeDiv = document.createElement('div');
            typeDiv.textContent = type;
            drawTypesDiv.appendChild(typeDiv);
        });
    }
    </script>
</body>
</html>0